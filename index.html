<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>To: Jiayi - Christmas Eve</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --emerald-deep: #013220;
            --gold-primary: #D4AF37;
            --gold-light: #F7EF8A;
            --velvet-red: #8B0000;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            height: 100vh; width: 100vw; overflow: hidden;
            font-family: 'Noto Serif SC', serif;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(145deg, var(--emerald-deep), #000);
            position: relative;
        }

        body.bg-success {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            transition: background 1.5s ease-in-out;
        }

        canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }

        /* === ä¿¡å°å±‚ === */
        #envelope-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1a0b0b; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s ease; 
        }
        
        .envelope-wrapper {
            position: relative; width: 280px; height: 180px;
            background: #8B0000; border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: flex; justify-content: center; align-items: center;
            animation: floatEnvelope 3s ease-in-out infinite;
            /* å¢å¤§ç‚¹å‡»çƒ­åŒºï¼Œç¡®ä¿èƒ½ç‚¹åˆ° */
            cursor: pointer;
        }
        .envelope-wrapper::before {
            content: ''; position: absolute; top: 0; left: 0;
            border-left: 140px solid transparent; border-right: 140px solid transparent;
            border-top: 100px solid #A52A2A; z-index: 2; transform-origin: top;
        }
        .heart-seal {
            width: 45px; height: 45px; background: var(--gold-primary);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 24px; color: #8B0000; z-index: 3; margin-top: -30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: pulseSeal 1.5s infinite;
        }
        .click-hint {
            margin-top: 40px; color: var(--gold-primary);
            font-family: 'Ma Shan Zheng', cursive; font-size: 1.2rem;
            opacity: 0.8; letter-spacing: 2px; animation: blinkText 2s infinite;
            pointer-events: none; /* é˜²æ­¢ç‚¹å­—ç‚¹ä¸åˆ°ä¿¡å° */
        }
        @keyframes floatEnvelope { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulseSeal { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes blinkText { 0%, 100% { opacity: 0.8; } 50% { opacity: 0.4; } }

        /* === ä¸»å¡ç‰‡ === */
        #container {
            position: relative; z-index: 10;
            width: 95%; max-width: 420px;
            height: auto; max-height: 92vh;
            opacity: 0; transform: scale(0.95); transition: all 1s ease;
            display: flex; justify-content: center;
            visibility: hidden; /* åˆå§‹éšè—ï¼Œé˜²æ­¢è¯¯è§¦ */
        }

        .card-gold-edge {
            padding: 3px; border-radius: 30px;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light), var(--gold-primary));
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            width: 100%; overflow-y: auto; scrollbar-width: none;
        }
        
        .card-velvet {
            background: radial-gradient(circle at center, #A50000 0%, #8B0000 70%, #4d0000 100%);
            border-radius: 28px; padding: 20px 15px;
            text-align: center; position: relative; min-height: 480px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .ornament { position: absolute; color: var(--gold-primary); opacity: 0.5; font-size: 20px; user-select: none; }
        .orn-tl { top: 15px; left: 15px; } .orn-tr { top: 15px; right: 15px; transform: rotate(90deg); }
        .orn-bl { bottom: 15px; left: 15px; transform: rotate(-90deg); } .orn-br { bottom: 15px; right: 15px; transform: rotate(180deg); }

        .polaroid {
            background: white; padding: 6px 6px 25px 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transform: rotate(-2deg);
            margin-bottom: 15px; margin-top: 5px; border: 1px solid rgba(0,0,0,0.05);
            animation: float 5s ease-in-out infinite; width: 55%; max-width: 160px;
        }
        .polaroid img { width: 100%; height: auto; max-height: 120px; object-fit: cover; display: block; background: #f0f0f0; }
        .polaroid p { font-family: 'Zhi Mang Xing', cursive; color: #333; margin-top: 5px; font-size: 14px; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-8px) rotate(1deg); } }

        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            background: linear-gradient(to bottom, var(--gold-light), var(--gold-primary));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-size: 1.7rem; margin-bottom: 8px; letter-spacing: 2px;
        }
        .message { font-family: 'Zhi Mang Xing', cursive; color: rgba(255,255,255,0.95); font-size: 1.1rem; line-height: 1.5; margin-bottom: 12px; }
        .highlight-name { font-size: 1.4rem; color: var(--gold-light); margin: 0 4px; }
        .ask-text { font-family:'Ma Shan Zheng', cursive; margin-top:8px; color:var(--gold-primary); font-size: 1.25rem; }

        .countdown-container {
            background: rgba(0,0,0,0.2);
            border-radius: 15px; padding: 8px; width: 90%; margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-around;
            color: var(--gold-primary);
        }
        .cd-item { display: flex; flex-direction: column; }
        .cd-val { font-size: 1.3rem; font-weight: bold; }
        .cd-label { font-size: 0.6rem; opacity: 0.7; }

        .button-group { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; padding-bottom: 5px; position: relative; min-height: 50px;}
        @media (min-width: 640px) { .button-group { flex-direction: row; justify-content: center; gap: 20px; } }

        button { outline: none; -webkit-tap-highlight-color: transparent; user-select: none; }

        .btn-yes {
            width: 140px; padding: 10px 0; border-radius: 50px; font-weight: bold; color: #4d0000; border: none; cursor: pointer;
            background: linear-gradient(135deg, #BF953F, #FCF6BA, #B38728, #FBF5B7, #AA771C);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 1rem;
            animation: gold-breathing 4s ease-in-out infinite;
            position: relative; z-index: 50; /* ä¿è¯åœ¨æœ€ä¸Šå±‚ */
        }
        .btn-no {
            width: 140px; padding: 10px 0; border-radius: 50px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(212,175,55,0.4); color: var(--gold-primary); font-weight: bold;
            cursor: pointer; font-size: 1rem;
            position: relative; /* åˆå§‹ç›¸å¯¹å®šä½ */
            transition: all 0.1s ease; /* ç§»åŠ¨æ›´å¿« */
        }
        @keyframes gold-breathing { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }

        .hidden { display: none !important; }
        #content-invite, #content-success { transition: opacity 0.5s ease; width: 100%; }
        
        .success-title { font-size: 2.2rem; color: var(--gold-light); margin-bottom: 10px; font-family:'Zhi Mang Xing', cursive;}
        .success-text { font-size: 1.2rem; line-height: 1.6; color: white; font-family:'Ma Shan Zheng', cursive;}

        .footer { position: fixed; bottom: 10px; width: 100%; text-align: center; z-index: 5; pointer-events: none; opacity: 0; transition: opacity 1s;}
        .footer-quote { font-family: 'Zhi Mang Xing', cursive; color: var(--gold-light); opacity: 0.8; font-size: 0.9rem; }

        @keyframes bounce-in { 0% { transform: scale(0.6); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-celebrate { animation: bounce-in 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-invite">
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="bgMusic" loop preload="auto">
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <canvas id="bg-canvas"></canvas>
    <canvas id="effect-canvas"></canvas>

    <!-- ä¿¡å°å±‚ï¼šå¢åŠ  ontouchstart ä»¥å…¼å®¹æ›´å¤šæ‰‹æœº -->
    <div id="envelope-layer" onclick="handleEnvelopeClick()" ontouchstart="handleEnvelopeClick()">
        <div class="envelope-wrapper">
            <div class="heart-seal">â¤ï¸</div>
        </div>
        <div class="click-hint">To: äº²çˆ±çš„ä½³ä¼Š (ç‚¹å‡»æ‹†å¯)</div>
    </div>

    <div id="container">
        <div class="card-gold-edge">
            <div class="card-velvet">
                <div class="ornament orn-tl">â¦</div>
                <div class="ornament orn-tr">â¦</div>
                <div class="ornament orn-bl">â¦</div>
                <div class="ornament orn-br">â¦</div>

                <div class="polaroid">
                    <img src="https://media.giphy.com/media/26BRv0ThflsHCqDrG/giphy.gif" alt="Christmas">
                    <p>Our Christmas Eve</p>
                </div>

                <div id="content-invite">
                    <h1>ä¸€ä»½å¹³å®‰å¤œçš„ç‰¹åˆ«é‚€çº¦</h1>
                    <div class="message">
                        <p>äº²çˆ±çš„ <span class="highlight-name">å‘¨ä½³ä¼Š</span>ï¼Œ</p>
                        <p>åœ¨è¿™ä¸ªå¹³å®‰å–œä¹çš„å¤œæ™šï¼Œ</p>
                        <p>æˆ‘ä¸æƒ³é”™è¿‡å’Œä½ åœ¨ä¸€èµ·çš„æ¯ä¸€ç§’ã€‚</p>
                        <p class="ask-text">ä½ æ„¿æ„æ¥å—æˆ‘çš„çº¦ä¼šé‚€è¯·å—ï¼Ÿ</p>
                    </div>

                    <div class="countdown-container" id="countdown">
                        <div class="cd-item"><span class="cd-val" id="days">0</span><span class="cd-label">å¤©</span></div>
                        <div class="cd-item"><span class="cd-val" id="hours">00</span><span class="cd-label">æ—¶</span></div>
                        <div class="cd-item"><span class="cd-val" id="mins">00</span><span class="cd-label">åˆ†</span></div>
                        <div class="cd-item"><span class="cd-val" id="secs">00</span><span class="cd-label">ç§’</span></div>
                    </div>

                    <div class="button-group">
                        <button class="btn-yes" onclick="acceptInvitation(event)">æˆ‘æ„¿æ„</button>
                        <!-- è¿™é‡Œçš„ onclick å¼ºåˆ¶æ‹¦æˆªï¼Œé˜²æ­¢è·³è½¬ -->
                        <button class="btn-no" id="btn-no" onclick="handleNoClick(event)">è€ƒè™‘ä¸€ä¸‹</button>
                    </div>
                </div>

                <div id="content-success" class="hidden">
                    <div class="animate-celebrate">
                        <div style="font-size: 50px; margin-bottom: 10px;">ğŸ’</div>
                        <h2 class="success-title">å¤ªæ£’äº†ï¼Œä½³ä¼Šï¼</h2>
                        <p class="success-text">æˆ‘ä¼šå‡†æ—¶å»æ¥ä½ ï¼â¤ï¸</p>
                        <div style="margin-top: 25px; padding: 8px 15px; border-top: 1px solid var(--gold-primary); border-bottom: 1px solid var(--gold-primary); color: var(--gold-light); font-size: 1.2rem; font-family:'Ma Shan Zheng', cursive; display: inline-block;">
                            12æœˆ24æ—¥ 17:20 è§
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer" id="footer-text">
        <p class="footer-quote">æ‰€æœ‰çš„å‡†å¤‡ï¼Œåªä¸ºåšä½ ä¸€ç¬‘ã€‚â¤ï¸</p>
    </div>

    <script>
        // === 1. æ ¸å¿ƒä¿®å¤ï¼šéŸ³ä¹ä¸å¼€åœº ===
        let musicStarted = false; // é˜²æ­¢é‡å¤è§¦å‘

        function handleEnvelopeClick() {
            if (musicStarted) return;
            musicStarted = true;

            const envelope = document.getElementById('envelope-layer');
            const mainContainer = document.getElementById('container');
            const audio = document.getElementById('bgMusic');
            const footer = document.getElementById('footer-text');

            // --- å¼ºåˆ¶æ’­æ”¾éŸ³ä¹ (æ ¸å¿ƒä¿®å¤) ---
            if (audio) {
                audio.volume = 0.6;
                // ç›´æ¥ playï¼Œä¸åŠ ä»»ä½•æ¡ä»¶ï¼Œåˆ©ç”¨ç”¨æˆ·å½“å‰çš„ç‚¹å‡»åŠ¨ä½œ
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("Audio play failed (will retry):", error);
                        // å¦‚æœå¤±è´¥ï¼Œå†æ¬¡ç›‘å¬ä¸€æ¬¡å…¨å±€ç‚¹å‡»æ¥é‡è¯•
                        document.addEventListener('click', () => audio.play(), { once: true });
                    });
                }
            }

            // åŠ¨ç”»é€»è¾‘
            envelope.style.opacity = '0'; 
            setTimeout(() => {
                envelope.style.display = 'none'; 
                mainContainer.style.visibility = 'visible'; // ç¡®ä¿ä¹‹å‰æ˜¯éšè—çš„
                mainContainer.style.opacity = '1';
                mainContainer.style.transform = 'scale(1)';
                footer.style.opacity = '1';
            }, 800);
        }

        // === 2. æ ¸å¿ƒä¿®å¤ï¼šæ‹’ç»æŒ‰é’®é˜²è¯¯è§¦ ===
        const btnNo = document.getElementById('btn-no');
        
        // å¤„ç†â€œè€ƒè™‘ä¸€ä¸‹â€æŒ‰é’®çš„ç‚¹å‡»ï¼šç»å¯¹ä¸è®¸è·³è½¬ï¼
        function handleNoClick(e) {
            e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
            e.preventDefault();  // é˜»æ­¢é»˜è®¤è¡Œä¸º
            
            // å¼¹çª—æç¤ºï¼Œæˆ–è€…å†æ¬¡ç§»åŠ¨
            dodge(); 
            // alert("å¬è¯ï¼Œç‚¹å·¦è¾¹~"); // å¦‚æœä½ éœ€è¦å¼¹çª—å°±æŠŠè¿™è¡Œæ³¨é‡Šæ‰“å¼€
            return false;
        }

        // æŒ‰é’®èº²é¿é€»è¾‘
        function dodge() {
            if (isSuccess) return;
            // è·å–å®¹å™¨èŒƒå›´ï¼Œé˜²æ­¢è·‘å‡ºå¡ç‰‡å¤ªè¿œ
            const container = document.querySelector('.card-velvet');
            const rect = container.getBoundingClientRect();
            
            // è®¡ç®—éšæœºä½ç½® (é™åˆ¶åœ¨å¡ç‰‡å†…éƒ¨)
            const maxX = 100; // å·¦å³å¹…åº¦
            const maxY = 100; // ä¸Šä¸‹å¹…åº¦
            
            const randomX = (Math.random() * 2 - 1) * maxX;
            const randomY = (Math.random() * 2 - 1) * maxY;

            btnNo.style.position = 'absolute'; // å˜æˆç»å¯¹å®šä½
            btnNo.style.transform = `translate(${randomX}px, ${randomY}px)`;
            
            // éšæœºæ—‹è½¬ä¸€ç‚¹ç‚¹ï¼Œå¢åŠ è°ƒçš®æ„Ÿ
            btnNo.style.rotate = (Math.random() * 20 - 10) + 'deg';
        }

        // ç»‘å®šç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶ï¼Œæ‰‹æŒ‡ä¸€ç¢°å°±è·‘
        btnNo.addEventListener('touchstart', (e) => {
            e.preventDefault(); // é˜²æ­¢å˜æˆç‚¹å‡»
            dodge();
        }, { passive: false });
        
        btnNo.addEventListener('mouseenter', dodge); // ç”µè„‘ç«¯é¼ æ ‡æ‚¬åœ

        // === 3. æ­£å¸¸æµç¨‹ï¼šæ¥å—é‚€è¯· ===
        function acceptInvitation(e) {
            if(e) e.stopPropagation();
            
            isSuccess = true;
            document.body.className = 'bg-success';
            document.getElementById('content-invite').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('content-invite').style.display = 'none';
                document.getElementById('content-success').classList.remove('hidden');
            }, 600);
            createSuccessParticles(); spawnCelebration();
        }


        // === è§†è§‰æ•ˆæœ (é›ªèŠ±/çƒŸèŠ± - è½»é‡åŒ–ç‰ˆ) ===
        const bgCanvas = document.getElementById('bg-canvas');
        const effCanvas = document.getElementById('effect-canvas');
        const bgCtx = bgCanvas.getContext('2d');
        const effCtx = effCanvas.getContext('2d');
        let width, height;
        let isSuccess = false;
        let snowflakes = [];
        let successParticles = [];
        let explosionParticles = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            bgCanvas.width = width; bgCanvas.height = height;
            effCanvas.width = width; effCanvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        function createSnow() {
            snowflakes = [];
            let count = Math.min(width / 15, 60); 
            for(let i=0; i<count; i++) {
                snowflakes.push({
                    x: Math.random() * width, y: Math.random() * height,
                    r: Math.random() * 3 + 1, s: Math.random() * 1 + 0.5, o: Math.random() * 0.5 + 0.1
                });
            }
        }

        function createSuccessParticles() {
            successParticles = [];
            const colors = ['#D4AF37', '#F7EF8A', '#FFB6C1'];
            for(let i=0; i<50; i++) {
                successParticles.push({
                    x: Math.random() * width, y: height + Math.random() * 200,
                    size: Math.random() * 6 + 3, speed: Math.random() * 2 + 1,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    type: Math.random() > 0.5 ? 'heart' : 'confetti',
                    rot: Math.random() * 360, rs: Math.random() * 4 - 2
                });
            }
        }

        function drawHeart(ctx, x, y, size, color) {
            ctx.save(); ctx.beginPath(); ctx.fillStyle = color; ctx.translate(x, y);
            ctx.moveTo(0, 0);
            ctx.bezierCurveTo(0, -size/2, -size, -size/2, -size, 0);
            ctx.bezierCurveTo(-size, size/2, 0, size, 0, size*1.5);
            ctx.bezierCurveTo(0, size, size, size/2, size, 0);
            ctx.bezierCurveTo(size, -size/2, 0, -size/2, 0, 0);
            ctx.fill(); ctx.restore();
        }

        function animate() {
            bgCtx.clearRect(0, 0, width, height);
            if (!isSuccess) {
                snowflakes.forEach(f => {
                    bgCtx.save(); bgCtx.globalAlpha = f.o;
                    bgCtx.fillStyle = '#fff'; bgCtx.beginPath();
                    bgCtx.arc(f.x, f.y, f.r, 0, Math.PI*2); bgCtx.fill(); bgCtx.restore();
                    f.y += f.s;
                    if(f.y > height) { f.y = -10; f.x = Math.random() * width; }
                });
            } else {
                successParticles.forEach(p => {
                    bgCtx.globalAlpha = 0.6;
                    if(p.type === 'heart') { drawHeart(bgCtx, p.x, p.y, p.size/2, p.color); }
                    else {
                        bgCtx.save(); bgCtx.translate(p.x, p.y); bgCtx.rotate(p.rot * Math.PI / 180);
                        bgCtx.fillStyle = p.color; bgCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size); bgCtx.restore();
                    }
                    p.y -= p.speed; p.rot += p.rs;
                    if(p.y < -50) { p.y = height + 50; p.x = Math.random() * width; }
                });
            }
            requestAnimationFrame(animate);
        }

        createSnow(); animate();

        function spawnCelebration() {
            const colors = ['#FF1493', '#D4AF37', '#FFFFFF'];
            for(let i=0; i<60; i++) {
                const angle = Math.random() * Math.PI * 2; const speed = Math.random() * 10 + 2;
                explosionParticles.push({
                    x: width / 2, y: height / 2, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
                    life: 1, color: colors[Math.floor(Math.random()*colors.length)], size: Math.random() * 4 + 2
                });
            }
            updateExplosion();
        }

        function updateExplosion() {
            effCtx.clearRect(0, 0, width, height);
            explosionParticles = explosionParticles.filter(p => p.life > 0);
            explosionParticles.forEach(p => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.2; p.life -= 0.015;
                effCtx.globalAlpha = p.life; effCtx.fillStyle = p.color;
                effCtx.beginPath(); effCtx.arc(p.x, p.y, p.size, 0, Math.PI*2); effCtx.fill();
            });
            if(explosionParticles.length > 0) { requestAnimationFrame(updateExplosion); }
        }

        function updateCountdown() {
            const target = new Date(new Date().getFullYear(), 11, 24, 17, 20, 0).getTime();
            const now = Date.now();
            const diff = target - now;
            if (diff <= 0) {
                document.getElementById('countdown').innerHTML = `<p style="font-size:1.1rem; width:100%; color:var(--gold-light); font-weight:bold; letter-spacing:2px;">å¹³å®‰å¤œå¿«ä¹ï¼â¤ï¸</p>`;
                return;
            }
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById('days').innerText = d;
            document.getElementById('hours').innerText = String(h).padStart(2, '0');
            document.getElementById('mins').innerText = String(m).padStart(2, '0');
            document.getElementById('secs').innerText = String(s).padStart(2, '0');
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();
    </script>
</body>
</html>
